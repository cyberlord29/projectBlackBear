!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-scale"),require("d3-selection"),require("d3-path"),require("d3-shape"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-selection","d3-path","d3-shape","d3-array"],n):n(t.fc=t.fc||{},t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,n,e,r,i,o){"use strict";function a(){var t=arguments;return function(n,e){for(var r=0,i=t.length;r<i;r++)if(null==t[r](n,e))return!1;return!0}}var u=function(t,n){t=t||"g";var e=function(t,n){return n},r=null,i=function(i,o){o=o||function(t){return t};var a=i.selection?i:null;a&&(i=i.selection());var u=i.selectAll(function(t,n,e){return Array.from(e[n].childNodes).filter(function(t){return 1===t.nodeType})}).filter(null==n?t:t+"."+n),c=u.data(o,e),l=c.enter().append(t).attr("class",n),f=c.exit();c=c.merge(l);var s=a||r;return s&&(c=c.transition(s).style("opacity",1),l.style("opacity",1e-6),f=f.transition(s).style("opacity",1e-6)),f.remove(),c.enter=function(){return l},c.exit=function(){return f},c};return i.element=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],i):t},i.className=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],i):n},i.key=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],i):e},i.transition=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],i):r},i},c=function(t){return"function"==typeof t?t:function(){return t}},l=function(){var t=null,n=function(t){return t.x},e=function(t){return t.y},i="center",o="center",a=function(t){return t.height},u=c(3),l=function(c,l){var f=t||r.path();return c.forEach(function(t,r){var c=n.call(this,t,l||r),s=e.call(this,t,l||r),h=a.call(this,t,l||r),d=u.call(this,t,l||r),g=void 0;switch(i){case"left":g=d;break;case"right":g=0;break;case"center":g=d/2;break;default:throw new Error("Invalid horizontal alignment "+i)}var v=void 0;switch(o){case"bottom":v=-h;break;case"top":v=0;break;case"center":v=h/2;break;default:throw new Error("Invalid vertical alignment "+o)}f.rect(c-g,s-v,d,h)},this),t?null:f.toString()};return l.context=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],l):t},l.x=function(){return arguments.length?(n=c(arguments.length<=0?void 0:arguments[0]),l):n},l.y=function(){return arguments.length?(e=c(arguments.length<=0?void 0:arguments[0]),l):e},l.width=function(){return arguments.length?(u=c(arguments.length<=0?void 0:arguments[0]),l):u},l.horizontalAlign=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],l):i},l.height=function(){return arguments.length?(a=c(arguments.length<=0?void 0:arguments[0]),l):a},l.verticalAlign=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],l):o},l},f=function(t){return"function"==typeof t?t:function(){return t}},s=function(){var t=n.scaleIdentity(),r=n.scaleIdentity(),i="horizontal",o=function(t){return t.from},a=function(t){return t.to},c=function(){},s=u("g","annotation-band"),h=l().horizontalAlign("center").verticalAlign("center").x(0).y(0),d=function(n){if(n.selection&&s.transition(n),"horizontal"!==i&&"vertical"!==i)throw new Error("Invalid orientation");var u="horizontal"===i,l=u?function(t,n){return"translate("+t+", "+n+")"}:function(t,n){return"translate("+n+", "+t+")"},f=u?t:r,d=u?r:t,g=f.range(),v=g[1]-g[0],y=u?"height":"width",p=u?"width":"height",x=function(){return l((g[1]+g[0])/2,(d(a.apply(void 0,arguments))+d(o.apply(void 0,arguments)))/2)};h[p](v),h[y](function(){return d(a.apply(void 0,arguments))-d(o.apply(void 0,arguments))}),n.each(function(t,n,r){var o=s(e.select(r[n]),t);o.enter().attr("transform",x).append("path").classed("band",!0),o.attr("class","annotation-band "+i).attr("transform",x).select("path").attr("d",function(t,n){return h([t],n)}),c(o,t,n)})};return d.xScale=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],d):t},d.yScale=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],d):r},d.orient=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],d):i},d.decorate=function(){return arguments.length?(c=arguments.length<=0?void 0:arguments[0],d):c},d.fromValue=function(){return arguments.length?(o=f(arguments.length<=0?void 0:arguments[0]),d):o},d.toValue=function(){return arguments.length?(a=f(arguments.length<=0?void 0:arguments[0]),d):a},d},h=function(t,n,e){var r=n[e];if("function"!=typeof r)throw new Error("Attempt to rebind "+e+" which isn't a function on the source object");return function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];var a=r.apply(n,i);return a===n?t:a}},d=function(t,n){for(var e=arguments.length,r=Array(e>2?e-2:0),i=2;i<e;i++)r[i-2]=arguments[i];var o=!0,a=!1,u=void 0;try{for(var c,l=r[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var f=c.value;t[f]=h(t,n,f)}}catch(t){a=!0,u=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw u}}return t},g=function(t){return function(n){return t.reduce(function(t,n){return t&&n(t)},n)}},v=function(t,n){for(var e=arguments.length,r=Array(e>2?e-2:0),i=2;i<e;i++)r[i-2]=arguments[i];var o=g(r),a=!0,u=!1,c=void 0;try{for(var l,f=Object.keys(n)[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var s=l.value,d=o(s);d&&(t[d]=h(t,n,s))}}catch(t){u=!0,c=t}finally{try{!a&&f.return&&f.return()}finally{if(u)throw c}}return t},y=function(t){return t.map(function(t){return"string"==typeof t?new RegExp("^"+t+"$"):t})},p=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return n=y(n),function(t){return n.every(function(n){return!n.test(t)})&&t}},x=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return n=y(n),function(t){return n.some(function(n){return n.test(t)})&&t}},b=function(t){return function(n){return t[n]}},m=function(t){return t[0].toUpperCase()+t.slice(1)},k=function(t){return function(n){return t+m(n)}},S=function(){var t=n.scaleIdentity(),r=n.scaleIdentity(),i=function(t){return t},o=i,a=function(){},c="horizontal",l=u("g","annotation-line"),s=function(n){if(n.selection&&l.transition(n),"horizontal"!==c&&"vertical"!==c)throw new Error("Invalid orientation");var u="horizontal"===c,f=u?function(t,n){return"translate("+t+", "+n+")"}:function(t,n){return"translate("+n+", "+t+")"},s=u?"x2":"y2",h=u?t:r,d=u?r:t,g=u?"left-handle":"bottom-handle",v=u?"right-handle":"top-handle",y=u?"9":"0",p=u?"0":"9",x=u?"0.32em":"0.71em",b=u?"start":"middle",m=h.range(),k=function(){return f(m[0],d(i.apply(void 0,arguments)))},S=m[1]-m[0];n.each(function(t,n,r){var i=l(e.select(r[n]),t),u=i.enter().attr("transform",k).style("stroke","#bbb");u.append("line").attr(s,S),u.append("g").classed(g,!0).style("stroke","none"),u.append("g").classed(v,!0).style("stroke","none").attr("transform",f(S,0)).append("text").attr("text-anchor",b).attr("x",y).attr("y",p).attr("dy",x),i.attr("class","annotation-line "+c),i.attr("transform",k),i.select("line").attr(s,S),i.select("g."+v).attr("transform",f(S,0)),i.select("text").text(o),a(i,t,n)})};return s.xScale=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],s):t},s.yScale=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],s):r},s.value=function(){return arguments.length?(i=f(arguments.length<=0?void 0:arguments[0]),s):i},s.label=function(){return arguments.length?(o=f(arguments.length<=0?void 0:arguments[0]),s):o},s.decorate=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],s):a},s.orient=function(){return arguments.length?(c=arguments.length<=0?void 0:arguments[0],s):c},s},w=function(t){return"function"==typeof t?t:function(){return t}},_=function(t,n){switch(t){case"left":return n/2;case"right":return-n/2;default:return 0}},A=function(t){var n=Object.assign({},t),e=function(){};return Object.keys(n).forEach(function(t){e[t]=function(){return arguments.length?(n[t]=arguments.length<=0?void 0:arguments[0],e):n[t]}}),e},I=function(){var t=function(){return 0},e=function(t){return t.x},r=function(t){return t.y},i="center",o=function(){return 5},u="vertical",c=A({decorate:function(){},defined:function(n,i){return a(t,e,r)(n,i)},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return c.values=function(n,a){var l=o(n,a),f=_(i,l),s=c.xScale(),h=c.yScale();if("vertical"===u){var d=h(r(n,a),a),g=h(t(n,a),a),v=s(e(n,a),a)+f;return{d:n,x:v,y:d,y0:g,width:l,height:d-g,origin:[v,d],baseOrigin:[v,g],transposedX:v,transposedY:d}}var y=s(r(n,a),a),p=s(t(n,a),a),x=h(e(n,a),a)+f;return{d:n,x:x,y:y,y0:p,width:l,height:y-p,origin:[y,x],baseOrigin:[p,x],transposedX:y,transposedY:x}},c.baseValue=function(){return arguments.length?(t=w(arguments.length<=0?void 0:arguments[0]),c):t},c.crossValue=function(){return arguments.length?(e=w(arguments.length<=0?void 0:arguments[0]),c):e},c.mainValue=function(){return arguments.length?(r=w(arguments.length<=0?void 0:arguments[0]),c):r},c.bandwidth=function(){return arguments.length?(o=w(arguments.length<=0?void 0:arguments[0]),c):o},c.align=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],c):i},c.orient=function(){return arguments.length?(u=arguments.length<=0?void 0:arguments[0],c):u},c},z={red:"#c60",green:"#6c0",black:"#000",gray:"#ddd",darkGray:"#999"},V=function(){var t=i.symbol(),n=I(),r=u("g","point"),o=function(t){return"translate("+t[0]+", "+t[1]+")"},a=function(i){i.selection&&r.transition(i),i.each(function(i,a,u){var c=i.filter(n.defined()),l=r(e.select(u[a]),c);l.enter().attr("transform",function(t,e){return o(n.values(t,e).origin)}).attr("fill",z.gray).attr("stroke",z.black).append("path"),l.attr("transform",function(t,e){return o(n.values(t,e).origin)}).select("path").attr("d",t),n.decorate()(l,i,a)})};return v(a,n,p("baseValue","bandwidth","align")),d(a,r,"key"),d(a,t,"type","size"),a},E=function(){var t=[],e=function(t){return t},r=function(t,n){return n},i=A({decorate:function(){},xScale:n.scaleIdentity(),yScale:n.scaleIdentity()});return i.mapping=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],i):e},i.key=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],i):r},i.series=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],i):t},i},j=function(){var t=E(),n=u("g"),r=u("g","multi"),i=function(i){i.selection&&(r.transition(i),n.transition(i));var o=t.mapping(),a=t.series(),u=t.xScale(),c=t.yScale();i.each(function(i,l,f){var s=r(e.select(f[l]),a);s.each(function(t,r,l){t.xScale(u).yScale(c);var f=o(i,r,a);n(e.select(l[r]),[f]).call(t)}),(s.selection?s.selection():s).order(),t.decorate()(s,i,l)})};return v(i,t),d(i,r,"key"),i},O=function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)},q=function(){var t=function(t){return t.x},r=function(t){return t.y},i=n.scaleIdentity(),o=n.scaleIdentity(),a=function(){},c=u("g","annotation-crosshair"),l=V(),f=S(),s=S().orient("vertical"),h=n.scaleIdentity(),d=n.scaleIdentity(),g=j().series([f,s,l]).xScale(h).yScale(d).mapping(function(t){return[t]}),y=function(n){n.selection&&c.transition(n),n.each(function(n,u,v){var y=c(e.select(v[u]),n);y.enter().style("pointer-events","none"),h.range(i.range()),d.range(o.range()),l.crossValue(t).mainValue(r),f.value(r),s.value(t),y.call(g),a(y,n,u)})};y.x=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],y):t},y.y=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],y):r},y.xScale=function(){return arguments.length?(i=arguments.length<=0?void 0:arguments[0],y):i},y.yScale=function(){return arguments.length?(o=arguments.length<=0?void 0:arguments[0],y):o},y.decorate=function(){return arguments.length?(a=arguments.length<=0?void 0:arguments[0],y):a};var p=x("label");return v(y,f,p,k("y")),v(y,s,p,k("x")),y},C=function(){var t=n.scaleIdentity(),e=[10],r=null,i=function(){var n;return null!=r?r:t.ticks?(n=t).ticks.apply(n,O(e)):t.domain()};return i.scale=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],i):t},i.ticks=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=n,i},i.tickArguments=function(){return arguments.length?(e=arguments.length<=0?void 0:arguments[0],i):e},i.tickValues=function(){return arguments.length?(r=arguments.length<=0?void 0:arguments[0],i):r},i},D=function(t){return t},G=function(){var t=function(){},n=function(){},r=C(),i=C(),o=u("line","gridline-y").key(D),a=u("line","gridline-x").key(D),c=function(u){u.selection&&(o.transition(u),a.transition(u)),u.each(function(u,c,l){var f=l[c],s=e.select(l[c]),h=r.scale(),d=i.scale(),g=f.__x_scale__||h;f.__x_scale__=h.copy();var v=r(),y=o(s,v);y.enter().attr("x1",g).attr("x2",g).attr("y1",d.range()[0]).attr("y2",d.range()[1]),y.attr("x1",h).attr("x2",h).attr("y1",d.range()[0]).attr("y2",d.range()[1]).attr("stroke","#bbb"),y.exit().attr("x1",h).attr("x2",h),t(y,v,c);var p=f.__y_scale__||d;f.__y_scale__=d.copy();var x=i(),b=a(s,x);b.enter().attr("y1",p).attr("y2",p).attr("x1",h.range()[0]).attr("x2",h.range()[1]),b.attr("y1",d).attr("y2",d).attr("x1",h.range()[0]).attr("x2",h.range()[1]).attr("stroke","#bbb"),b.exit().attr("y1",d).attr("y2",d),n(b,x,c)})};return c.yDecorate=function(){return arguments.length?(n=arguments.length<=0?void 0:arguments[0],c):n},c.xDecorate=function(){return arguments.length?(t=arguments.length<=0?void 0:arguments[0],c):t},v(c,o,b({key:"xKey"})),v(c,a,b({key:"yKey"})),v(c,r,k("x")),v(c,i,k("y")),c};t.annotationSvgBand=s,t.annotationSvgCrosshair=q,t.annotationSvgLine=S,t.annotationSvgGridline=G,Object.defineProperty(t,"__esModule",{value:!0})});